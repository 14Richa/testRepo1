name: TSC Member Update

on:
  pull_request:
    types: [closed]

jobs:
  update_tsc_member:
    if: github.event.pull_request.merged
    name: Update TSC Member
    runs-on: ubuntu-latest

    steps:
      - name: Checkout main branch
        uses: actions/checkout@v2
        with:
          ref: main
          path: testRepo-main

      - name: Checkout one commit before last one
        uses: actions/checkout@v2
        with:
          fetch-depth: 2
          ref: main
          path: testRepo

      - run: cd testRepo && git checkout HEAD^

      - name: Install js-yaml
        run: npm install js-yaml@4.1.0

      - name: Compare files
        id: compare-files
        uses: actions/github-script@v6
        with:
          script: |
            const fs = require('fs');
            const yaml = require('js-yaml');

            const mainFile = yaml.load(fs.readFileSync('./testRepo-main/MAINTAINERS.yaml', 'utf8'));
            const prFile = yaml.load(fs.readFileSync('./testRepo/MAINTAINERS.yaml', 'utf8')); 

            // Function to check if isTscMember value has changed
            function hasIsTscMemberChanged(maintainerName) {
              const mainMaintainer = mainFile.find(m => m.name === maintainerName);
              const prMaintainer = prFile.find(m => m.name === maintainerName);

              if (!mainMaintainer || !prMaintainer) {
                console.error('Maintainer not found:', maintainerName);
                return;
              }

              if (mainMaintainer.isTscMember !== prMaintainer.isTscMember) {
                console.log(`isTscMember value changed for ${maintainerName}`);
              } else {
                console.log(`isTscMember value remains the same for ${maintainerName}`);
              }
            }

            // Loop over all maintainers in the main file (assuming the main file contains all maintainers)
            mainFile.forEach(maintainer => {
              hasIsTscMemberChanged(maintainer.name);
            });
